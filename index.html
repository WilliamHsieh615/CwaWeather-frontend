<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>SkyPulse</title>
    <link rel="icon" type="image/png" href="./icon-v2.png" />
    <link rel="apple-touch-icon" href="./icon-v2.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --pulse-blue: #4FB5D9;
            --pulse-deep: #2C87B0;
            --mist-white: #FFFEF2;
            --sun-yellow: #F9F195;
            --calm-green: #8FD8AF;
            --muted-brown: #58504A;
            --card-border: rgba(255, 255, 255, 0.9);
            --glass: rgba(255, 255, 255, 0.06);
            --glass-strong: rgba(255, 255, 255, 0.12);
            --bg: linear-gradient(180deg, #E8F8FF 0%, #F2FCFF 35%, #EAF8FF 100%);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent
        }

        html,
        body {
            height: 100%
        }

        body {
            font-family: "Inter", system-ui, -apple-system, "Helvetica Neue", Arial;
            background: var(--bg);
            color: var(--muted-brown);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            padding-bottom: 28px;
        }

        /* layout container */
        .viewport {
            max-width: 760px;
            margin: 0 auto;
            padding: 18px;
        }

        /* header / brand */
        .topbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            padding: 12px 6px;
            position: sticky;
            top: 0;
            z-index: 50;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.3));
            backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.6);
        }

        .brand {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .logo {
            width: 44px;
            height: 44px;
            background: url("icon-v2.png") no-repeat center/contain;
            background-color: var(--pulse-blue);
            /* fallback */
            box-shadow: 0 6px 18px rgba(46, 138, 176, 0.18), inset 0 -4px 8px rgba(255, 255, 255, 0.06);
        }

        .brand-title {
            display: flex;
            flex-direction: column;
            line-height: 1;
        }

        .brand-title .name {
            font-weight: 700;
            color: var(--pulse-deep);
            letter-spacing: 0.4px;
            font-size: 1.5rem;
        }

        .brand-title .tag {
            font-size: 0.75rem;
            color: var(--pulse-deep);
            opacity: 0.75;
        }

        .update-pill {
            font-size: 1rem;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0.06));
            padding: 6px 10px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: var(--pulse-deep);
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(44, 135, 176, 0.08);
        }

        /* hero */
        .hero-card {
            margin-top: 18px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.90));
            border-radius: 22px;
            padding: 22px;
            position: relative;
            overflow: visible;
            border: 1px solid var(--card-border);
            box-shadow: 0 10px 30px rgba(46, 138, 176, 0.07);
        }

        /* pulse decorative wave */
        .pulse-wave {
            position: absolute;
            left: 20px;
            right: 20px;
            bottom: -18px;
            height: 60px;
            border-radius: 20px;
            background: linear-gradient(90deg, rgba(79, 181, 217, 0.12), rgba(79, 181, 217, 0.06));
            filter: blur(10px);
            transform-origin: center;
            animation: gentleFloat var(--pulse-speed, 3.2s) ease-in-out infinite;
            z-index: 1;
        }

        @keyframes gentleFloat {
            0% {
                transform: translateY(0) scaleY(0.98)
            }

            50% {
                transform: translateY(-6px) scaleY(1.05)
            }

            100% {
                transform: translateY(0) scaleY(0.98)
            }
        }

        .hero-head {
            position: relative;
            z-index: 3;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 18px;
        }

        .hero-left {
            text-align: left;
        }

        .city {
            font-size: 2rem;
            font-weight: 800;
            color: var(--pulse-deep);
        }

        .slogan {
            font-size: 0.82rem;
            color: var(--pulse-deep);
            opacity: 0.8;
            margin-top: 4px;
            font-weight: 600;
        }

        .hero-right {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .hero-temp {
            font-size: 3.6rem;
            font-weight: 800;
            color: var(--pulse-deep);
            line-height: 1;
        }

        .hero-icon {
            font-size: 3.6rem;
            filter: drop-shadow(0 6px 6px rgba(46, 138, 176, 0.08));
            margin-right: 8px;
            animation: iconPulse 3s infinite ease-in-out;
        }

        @keyframes iconPulse {
            0% {
                transform: translateY(0)
            }

            50% {
                transform: translateY(-6px)
            }

            100% {
                transform: translateY(0)
            }
        }

        .hero-desc {
            margin-top: 8px;
            font-size: 1.05rem;
            color: #6a5f59;
            font-weight: 600;
        }

        /* small stats row */
        .mini-stats {
            margin-top: 14px;
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: space-between;
        }

        .stat {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.85));
            padding: 8px 12px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.7);
            min-width: 32%;
            text-align: center;
            font-weight: 600;
            font-size: 0.92rem;
            color: var(--pulse-deep);
        }

        /* advice grid */
        .advice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .advice-item {
            background: linear-gradient(180deg, rgba(79, 181, 217, 0.06), rgba(79, 181, 217, 0.03));
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(79, 181, 217, 0.08);
        }

        .advice-icon {
            font-size: 1.6rem
        }

        .advice-text {
            font-weight: 700;
            margin-top: 6px;
            color: var(--pulse-deep)
        }

        /* forecast scroll */
        .section-title {
            font-size: 1.05rem;
            color: var(--pulse-deep);
            font-weight: 800;
            margin: 22px 6px 10px 6px;
        }

        .scroll-container {
            display: flex;
            overflow-x: auto;
            gap: 12px;
            padding: 10px 6px 20px 6px;
            scrollbar-width: none;
        }

        .scroll-container::-webkit-scrollbar {
            display: none
        }

        .mini-card {
            min-width: 140px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.9));
            border-radius: 14px;
            padding: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.85);
            box-shadow: 0 6px 18px rgba(46, 138, 176, 0.04);
            flex-shrink: 0;
        }

        .mini-time {
            font-weight: 800;
            color: var(--pulse-deep);
            font-size: 0.88rem
        }

        .mini-icon {
            font-size: 1.8rem;
            margin: 6px 0
        }

        .mini-temp {
            font-weight: 800;
            color: #53483f
        }

        /* loading screen */
        .loading-screen {
            position: fixed;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, rgba(79, 181, 217, 0.06), rgba(79, 181, 217, 0.02));
            z-index: 9999;
        }

        .loading-emoji {
            font-size: 4.2rem;
            animation: loadBounce 1.6s infinite;
        }

        @keyframes loadBounce {
            0% {
                transform: translateY(0)
            }

            50% {
                transform: translateY(-8px)
            }

            100% {
                transform: translateY(0)
            }
        }

        /* responsive tweaks */
        @media (max-width:420px) {
            .hero-temp {
                font-size: 2.6rem
            }

            .hero-icon {
                font-size: 2.6rem
            }
        }
    </style>
</head>

<body>
    <div id="loading" class="loading-screen">
        <div class="loading-emoji">üå§Ô∏è</div>
        <p style="margin-top:14px;font-weight:700;color:var(--pulse-deep)">SkyPulse Ê≠£Âú®Áõ£ËÅΩÂ§©Á©∫ÁöÑËÑàÂãï‚Ä¶</p>
    </div>

    <div class="topbar">
        <div class="brand">
            <div class="logo"></div>
            <div class="brand-title">
                <div class="name">SkyPulse</div>
                <div class="tag">Feel the rhythm of the sky.</div>
            </div>
        </div>
        <div id="updateTime" class="update-pill">Êõ¥Êñ∞‰∏≠‚Ä¶</div>
    </div>

    <main class="viewport">
        <div id="mainContent" style="display:none;">
            <section class="hero-card" id="heroCard">
                <!-- Áî± JS Â°´ÂÖÖ hero ÂÖßÂÆπ -->
                <div class="pulse-wave" id="pulseWave" style="--pulse-speed:3.2s;"></div>
            </section>

            <h3 class="section-title">Á®çÂæåÈ†êÂ†±</h3>
            <div class="scroll-container" id="futureForecasts"></div>
        </div>
    </main>

    <script>
        // (‰øùÁïô‰Ω†ÂéüÊú¨ÁöÑ API Ë∑ØÂæëÔºåËã•Ë¶ÅÊîπÊàêÂÖ∂‰ªñÁ∏£Â∏ÇÂèØÂú®ÈÄôË£°Êõ¥Êñ∞)
        const API_URL = "https://william-weather-website.zeabur.app/api/weather/kaohsiung";

        function getWeatherIcon(weather) {
            if (!weather) return "üå§Ô∏è";
            if (weather.includes("Êô¥")) return "‚òÄÔ∏è";
            if (weather.includes("Â§öÈõ≤")) return "‚õÖ";
            if (weather.includes("Èô∞")) return "‚òÅÔ∏è";
            if (weather.includes("Èõ®")) return "üåßÔ∏è";
            if (weather.includes("Èõ∑")) return "‚õàÔ∏è";
            return "üå§Ô∏è";
        }

        function getAdvice(rainProb, maxTemp) {
            let rainIcon = "üåÇ";
            let rainText = "‰∏çÁî®Â∏∂ÂÇò";
            if (parseInt(rainProb) > 30) {
                rainIcon = "‚òÇÔ∏è";
                rainText = "Ë®òÂæóÂ∏∂ÂÇò";
            }

            let clothIcon = "üëï";
            let clothText = "ËàíÈÅ©Á©øÊê≠";
            if (parseInt(maxTemp) >= 28) {
                clothIcon = "üéΩ";
                clothText = "Áü≠Ë¢ñÂ∞±Â•Ω";
            } else if (parseInt(maxTemp) <= 20) {
                clothIcon = "üß•";
                clothText = "Âª∫Ë≠∞Âä†‰ª∂Â§ñÂ•ó";
            }

            return { rainIcon, rainText, clothIcon, clothText };
        }

        function getTimePeriod(startTime) {
            const hour = new Date(startTime).getHours();
            if (hour >= 5 && hour < 11) return "Êó©Êô®";
            if (hour >= 11 && hour < 14) return "‰∏≠Âçà";
            if (hour >= 14 && hour < 18) return "‰∏ãÂçà";
            if (hour >= 18 && hour < 23) return "Êôö‰∏ä";
            return "Ê∑±Â§ú";
        }

        // Â∞áËÑàÂãïÂãïÁï´ÈÄüÂ∫¶Ê†πÊìöÂ§©Ê∞£ÂãïÊÖãË™øÊï¥ÔºàË∂äÊøÄÁÉàÁöÑÂ§©Ê∞£ËÑàÂãïË∂äÂø´Ôºâ
        function setPulseSpeed(rainProb, maxTemp) {
            const wave = document.getElementById("pulseWave");
            // base speed 3.2s, Â¶ÇÊûúÊúâÈ´òÈôçÈõ®ÊàñÊ•µÁ´ØÊ∫´Â∫¶Âä†Âø´ÁØÄÂ•è
            let speed = 3.2;
            const rain = parseInt(rainProb);
            const t = parseInt(maxTemp);

            if (!isNaN(rain) && rain > 60) speed = 1.6;
            else if (!isNaN(rain) && rain > 30) speed = 2.4;

            // Ê∫´Â∫¶Ê•µÈ´ò‰πüÂèØÂä†Âø´ÊÑüË¶∫
            if (!isNaN(t) && t >= 34) speed = Math.min(speed, 1.8);

            wave.style.setProperty("--pulse-speed", speed + "s");
        }

        function renderWeather(data) {
            const forecasts = data.forecasts;
            if (!Array.isArray(forecasts) || forecasts.length === 0) {
                alert("SkyPulseÔºöÊ≤íÊúâÂèØÁî®ÁöÑÈ†êÂ†±Ë≥áÊñô");
                return;
            }

            const current = forecasts[0];
            const others = forecasts.slice(1);
            const avgTemp = Math.round((parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2);
            const period = getTimePeriod(current.startTime);
            const advice = getAdvice(current.rain, current.maxTemp);

            setPulseSpeed(current.rain, current.maxTemp);

            // Hero HTML
            const heroHTML = `
                <div class="hero-head">
                    <div class="hero-left">
                        <div class="city">üìç ÂçóÊäï</div>
                        <div class="slogan">SkyPulse ‚Äî ${period} ÁöÑÁØÄÂ•è</div>
                    </div>
                    <div class="hero-right">
                        <div style="display:flex;align-items:center;">
                            <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
                            <div class="hero-temp">${avgTemp}¬∞</div>
                        </div>
                    </div>
                </div>

                <div class="hero-desc">${current.weather} ¬∑ ÊúÄÈ´ò ${current.maxTemp}¬∞ ¬∑ ÊúÄ‰Ωé ${current.minTemp}¬∞</div>

                <div class="mini-stats">
                    <div class="stat">üíß ÈôçÈõ®Áéá <div style="font-size:0.95rem;margin-top:4px">${current.rain}</div></div>
                    <div class="stat">üå¨Ô∏è È¢®Âêë/È¢®ÈÄü <div style="font-size:0.95rem;margin-top:4px">${current.wind || "‚Äî"}</div></div>
                    <div class="stat">üîç Ê∞£Ë±°Ë™™Êòé <div style="font-size:0.85rem;margin-top:4px">${(current.note || "").slice(0, 30) || "ÁÑ°"}</div></div>
                </div>

                <div class="advice-grid">
                    <div class="advice-item">
                        <div class="advice-icon">${advice.rainIcon}</div>
                        <div class="advice-text">${advice.rainText}</div>
                        <div style="font-size:0.75rem;color:#6b6b6b;margin-top:6px">ÈôçÈõ®ÁéáÔºö${current.rain}</div>
                    </div>
                    <div class="advice-item">
                        <div class="advice-icon">${advice.clothIcon}</div>
                        <div class="advice-text">${advice.clothText}</div>
                        <div style="font-size:0.75rem;color:#6b6b6b;margin-top:6px">ÊúÄÈ´òÊ∫´Ôºö${current.maxTemp}¬∞</div>
                    </div>
                </div>
            `;

            document.getElementById('heroCard').insertAdjacentHTML('beforeend', heroHTML);

            // render future forecasts
            const scrollContainer = document.getElementById('futureForecasts');
            scrollContainer.innerHTML = '';

            const todayDate = new Date().getDate();

            others.forEach(f => {
                let p = getTimePeriod(f.startTime);
                const fDate = new Date(f.startTime);
                if (fDate.getDate() !== todayDate) {
                    p = "ÊòéÂ§© " + p;
                }

                const card = document.createElement('div');
                card.className = 'mini-card';
                card.innerHTML = `
                    <div class="mini-time">${p}</div>
                    <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
                    <div class="mini-temp">${f.minTemp}¬∞ - ${f.maxTemp}¬∞</div>
                    <div style="font-size:0.8rem;color:#6b6b6b;margin-top:6px">üíß ${f.rain}</div>
                `;
                scrollContainer.appendChild(card);
            });

            // update top-right date label
            const now = new Date();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            const dayIndex = now.getDay();
            const days = ["ÈÄ±Êó•", "ÈÄ±‰∏Ä", "ÈÄ±‰∫å", "ÈÄ±‰∏â", "ÈÄ±Âõõ", "ÈÄ±‰∫î", "ÈÄ±ÂÖ≠"];
            document.getElementById('updateTime').textContent = `${month}Êúà${date}Êó• ${days[dayIndex]}`;
        }

        async function fetchWeather() {
            try {
                const delayPromise = new Promise(resolve => setTimeout(resolve, 900)); // ËºïÂæÆÁ≠âÂæÖÊÑü
                const fetchPromise = fetch(API_URL).then(res => res.json());
                const [_, json] = await Promise.all([delayPromise, fetchPromise]);

                if (json.success) {
                    renderWeather(json.data);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'block';
                } else {
                    throw new Error("API Error");
                }
            } catch (e) {
                console.error(e);
                // Êõ¥ÂèãÂñÑÁöÑÈåØË™§ÊèêÁ§∫
                document.getElementById('loading').style.display = 'none';
                alert("SkyPulse ÁÑ°Ê≥ïÂèñÂæóË≥áÊñôÔºåË´ãÁ®çÂÄôÂÜçË©¶„ÄÇ");
            }
        }

        document.addEventListener('DOMContentLoaded', fetchWeather);
    </script>
</body>

</html>